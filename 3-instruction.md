# 指令系统

## 数据通路

8086 CPU 数据通路图示:

![datapath](assets/datapath.svg)

图中有 4 种实体，实体之间有 12 条 "可能" 的数据通路。其中 9 条实心箭头，对应 **9 条数据通路**。另有 3 条带 `X` 号的虚线箭头不是有效的数据通路。

根据数据通路定义，以下的九种 `MOV` 指令是合法的（其中 `ac` 为立即数, `reg` 为通用寄存器, `segreg` 为段寄存器, `mem` 为内存）:

    MOV reg, ac
    MOV reg, reg
    MOV reg, segreg
    MOV reg, mem
    MOV mem, ac
    MOV mem, reg
    MOV mem, segreg
    MOV segreg, reg
    MOV segreg, mem

注意: 使用段寄存器作为目的操作数时，不允许用 `CS` （修改 `CS` 只能通过段间跳转指令）。

## 段超越

采用数据的寄存器间接寻址或跳转的寄存器寻址时，寄存器中存储的都是相对于某个段的偏移量。特定寻址场景、特定寄存器对应有默认的段（隐式，一般不需要写出）:

- 数据访问: 
  - `BX`, `SI`, `DI` --> `DS`
  - `BP` --> `SS`
- 转移指令: `CS`
- 串指令的 `DI` 默认相对于 `ES`

如需改变默认相对的段，则使用段超越，即在 `[]` 前加 `段寄存器:` 以指定偏移量寄存器参考的段，例如 `SS:[BX]`, `CS:[DI]`。

## 类型转换

有时仅凭符号名/变量名很难准确知道内存操作数的类型。由于内存单元的基本单位是字节，所以无论变量如何定义，都可以进行类型转换。

通过 `BYTE PTR`, `WORD PTR`, `DWORD PTR` 三个操作符，明确地指定内存操作数的类型，或进行强制类型转换。

例如:

    MOV  BYTE PTR x, AL     ; 将 8 位的 AL 存入 x 对应的内存
    MOV  WORD PTR [DI], AX  ; 将 AX 中的一个 16 位的字存入 DI 寄存器所指向的内存地址



